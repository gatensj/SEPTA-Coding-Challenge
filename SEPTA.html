<!DOCTYPE html>
<html lang="en">


<head>

<!-- -->
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>SEPTA Regional Rail Zones</title>
<!-- -->

<!-- -->
<link href="core.css" rel="stylesheet">
<!-- -->

</head>


<body>

<!-- -->
<div class="bigDiv">

	<!-- -->
    <div class="sizeDiv">
    
    	<!-- -->
        <div class="containgDiv">

			<!-- -->
            <div class="containgDivHead">
            	<img src="https://upload.wikimedia.org/wikipedia/commons/c/ca/SEPTA.svg" class="mIMGresponsive logoIMG"/>
                <h2 class="innerHeaderTXT">Regional Rail Fares</h2>
            </div>
            <!-- -->

			<!-- -->
            <div class="containgDivBody">
            
            	<!-- -->
				<div class="QuestionDiv">

                    <h3 class="innerBodyTXT">Where are you going?</h3>
    
                    <select class="mForm dropDown" id="Zone">
                      <option value="1">CCP/1</option>
                      <option value="2">Zone 2</option>
                      <option value="3">Zone 3</option>
                      <option value="4">Zone 4</option>
                      <option value="5">NJ</option>
                    </select>
                
				</div>
                <!-- -->

            	<!-- -->
				<div class="QuestionDiv">

                    <h3 class="innerBodyTXT">When are you riding?</h3>
    
                    <select class="mForm dropDown" id="Type">
                      <label class="mInfo"><option class="helperTXT" value="weekday">Weekday</option></label>
                      <label class="mInfo"><option class="helperTXT" value="evening_weekend">Weekend / Evenings</option></label>
                      <label class="mInfo"><option class="helperTXT" value="anytime">Anytime</option></label>
                    </select>
                
                	<p class="helperTXT" id="mhelperTXT">Helper text that explains the options above.</p>
                
				</div>
                <!-- -->

            	<!-- -->
				<div class="QuestionDiv">

                    <h3 class="innerBodyTXT">Where will you purchase the fare?</h3>

                    <div class="radio radioDiv">
                    <label class="mInfo">
                    <input type="radio" class="helperTXT mRadio" name="Purchase" value="advance_purchase" checked="checked">
                    <span>Station Kiosk</span>
                    </label>
                    </div>

                    <div class="radio radioDiv">
                    <label class="mInfo">
                    <input type="radio" class="helperTXT mRadio" name="Purchase" value="onboard_purchase">
                    <span>Onboard</span>
                    </label>
                    </div>
                     
				</div>
                <!-- -->

            	<!-- -->
				<div class="QuestionDiv">

                    <h3 class="innerBodyTXT">How many rides will you need?</h3>
   					
                    <div class="inputTxtDIV">
                    <input class="mForm numeric" id="Trips" type="text" placeholder="Number of Rides">
                	</div>
                    
				</div>
                <!-- -->

            </div>
            <!-- -->

			<!-- -->
            <div class="containgDivFooters">
            	<h2 class="innerFooterTXT">Your fare will cost</h2>
                <h1 class="innerFooterTXTresults">$</h1>
            </div>
            <!-- -->
                    
        </div>
        <!-- -->
        
    </div>
    <!-- -->

</div>
<!-- -->

<!-- jQuery (necessary for Bootstrap's JavaScript plugins) --> 
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js" type="text/javascript"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js" type="text/javascript"></script>
<!-- -->

<!-- -->
<script>
$(document).ready(function(){
	
	//This is the jquery written to support the calculator functionality, writen by Jeremy Gatens.  Thanks for reviewing my code.  Take care and have a good day.


	//let's go get us some JSON
	var mURL = "fares.json";
	var SEPTAjson;
	
	$.getJSON(mURL, function(data){
		SEPTAjson = data;
	});
	
	
	//quick function to prevent letters in the ticket input
	$('.numeric').on('input', function (event) { 
		this.value = this.value.replace(/[^0-9]/g, '');
	});
	

	//functions to handle the helper text functionality with a holding variable
	function helperIn(n) {

			$.each(SEPTAjson.info, function(i, v) {
     		if (i.search(n) != -1){
					$("#mhelperTXT").html(v);
					return;
				}
			});

	}

	function helperOut(n) {
		$("#mhelperTXT").html(n);
	}	
	
	var text_val = "";
	
	
	//fires the helperinfo function on the dropdown
	$("#Type").change(function () {
        var end = this.value;
		helperIn(end);
    });


	//fires the helperinfo function on hover of the radio buttons
	$(".mInfo").hover(function(){
		text_val = $(this).children('.helperTXT').first().val();
		
		helperIn(text_val);
        }, function(){
        helperOut("<br/>");
    });


	//jquery event to fire after tickets input filled out
	$("#Trips").blur(function(){

		//quick check to make sure the form is complete
	    var empty = $(".containgDivBody").find("input").filter(function() {
            return this.value === "";
        });

        if(empty.length) {
            
            alert("Please fill out the number of tickets needed.");
			$("#Trips").focus();
			return  false;
        }
		

		//function to return the number formatted as a currency
		function formatCash(n, currency) {
		return currency + " " + n.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, "$1,");
		}


		//variable assignment
		var mZone = $("#Zone").val();
		var mType = $("#Type").val();
		var mPurchase = $('input:radio[name=Purchase]:checked').val();		
		var mTrips = $("#Trips").val();
		var mPrice;
		var mResult = 0;
		var returnedData;
		var holding;
	

		//logic to make sure anytime purchases are divisible by 10
		if(mType == "anytime")
		{
			if (mTrips % 10 != 0)
			{
				alert("Advanced trips must be purchased in sets of 10");
				return false;				
			}
			else
			{
				holding = mTrips / 10;
			}  
		}	
		

		//loop thru the json, find the zone and match the options
		$.each(SEPTAjson.zones, function(i, v) {
			if (v.zone == mZone) {
		   		returnedData = $.grep(v.fares, function(element, index){
				return element.type == mType && element.purchase == mPurchase;
			});			
			
			}
		});


		//check the json result and apply arithmetic logic
		if (returnedData.length != 1) {
		  alert('There was an unexpected problem.');
		  return false;
		} else {
			mPrice = returnedData[0].price;

			if(mType != "anytime")
			{
			mResult = mPrice * mTrips;	
			}
			else
			{
			mResult = mPrice * holding;	
			}
			 
			mResult = formatCash(mResult, "$");
			$(".innerFooterTXTresults").html(mResult);
		}

    });
});
</script>
<!-- -->


</body>


</html>